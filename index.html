<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Wahoo POI Enricher | GPX → Wahoo</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- App styles -->
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>
  <div id="boot-error" class="boot-error" style="display:none"></div>

  <!-- Top bar -->
  <header class="topbar" role="banner">
    <div>
      <button id="btn-toggle-left" class="icon-btn" aria-pressed="true" title="Toggle left panel">
        <i class="ico burger" aria-hidden="true"></i>
      </button>
    </div>
    <div class="brand" aria-label="App title">
      <span class="title">Wahoo POI Enricher</span>
    </div>
    <div>
      <button id="btn-add-poi" class="icon-btn" aria-pressed="false" title="Add POI">
        <i class="ico plus" aria-hidden="true"></i>
      </button>
      <button id="btn-toggle-right" class="icon-btn" aria-pressed="true" title="Toggle POIs panel">
        <i class="ico pin" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <!-- App layout -->
  <main class="app" role="main" aria-label="Map and panels">
    <!-- Left column -->
    <aside id="left-panel" class="panel-col open" aria-label="Left panel">
      <section class="panel" aria-labelledby="about-title">
        <h2 id="about-title">About</h2>
        <p>
          Load a GPX route and add nearby points of interest from OpenStreetMap: water taps, toilets, food, fuel, bike shops, campsites, viewpoints, and more. Alternatively, you can manually add POIs using the + button.
          <a href="https://support.wahoofitness.com/hc/en-us/articles/30255756674194-Custom-Waypoints-and-POIs-on-ELEMNT-ACE-BOLT-3-and-ROAM-3">Exported waypoints use Wahoo-compatible types so devices like the ACE, BOLT 3, and ROAM 3 display the right icons.</a>
          Tested on a ROAM 3: on-device maps currently render <code>water</code>, <code>food</code>, <code>summit</code>, <code>valley</code>, and <code>sprint</code> with dedicated icons; other documented types are shown as a <code>generic</code> marker.
        </p>
        <hr class="sep">
        <div class="donate">
          <p>If this tool helps you, consider supporting it:</p>
          <a class="donate-btn" href="https://www.paypal.com/donate/?hosted_button_id=MJF3AHPSQGFLS" target="_blank" rel="noopener noreferrer">
            <img alt="Donate via PayPal" src="https://img.shields.io/badge/Donate-PayPal-blue.svg">
          </a>
        </div>
      </section>

      <section class="panel" aria-labelledby="load-title">
        <h2 id="load-title">Load GPX</h2>
        <p class="hint">Pick a <strong>.gpx</strong> file. Drag &amp; drop anywhere also works.</p>
        <input id="file" type="file" accept=".gpx" />
        <p id="status" class="status-in-box hint"></p>
      </section>

      <section class="panel" aria-labelledby="corridor-title">
        <h2 id="corridor-title">Corridor &amp; Export</h2>
        <div class="poi-controls" style="margin:0 0 8px">
          <label>Corridor width (m):
            <input id="poi-range-m" type="number" min="5" step="5" value="100" />
          </label>
          <br>
          <label>
            Show line from POI to track:
            <input id="toggle-lines" type="checkbox" checked />
          </label>
        </div>
        <div class="poi-controls">
          <a id="btn-download-gpx" class="btn" href="#" download="enriched.gpx" style="display:none">
            Download enriched GPX
          </a>
        </div>
      </section>
    </aside>

    <!-- Map -->
    <div class="map-wrap" aria-label="Map">
      <div id="map"></div>
    </div>

    <!-- Right column: POI selection -->
    <aside id="right-panel" class="panel-col open" aria-label="POI panel">
      <section class="panel" id="poi-panel" aria-labelledby="poi-title">
        <h2 id="poi-title" style="margin-bottom:6px">POI Selection</h2>

        <div class="sticky-header">
          <p class="status-in-box hint" aria-live="polite">Click to remove a POI from the list.</p>
          <div id="selected-chips" class="chips" aria-live="polite"></div>
          <p id="poi-status" class="status-in-box hint" aria-live="polite"></p>

          <div class="fetch-row">
            <button id="btn-fetch-selected" class="btn" type="button">Fetch selected</button>
            <button id="btn-fetch-all" class="btn btn-ghost" type="button">Fetch ALL</button>
          </div>
        </div>

        <div id="poi-groups" class="poi-groups" role="region" aria-label="POI categories"></div>
      </section>
    </aside>
  </main>

  <!-- Add-POI Modal -->
  <div id="add-poi-modal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="add-poi-heading" aria-modal="true">
      <div class="modal-head">
        <h3 id="add-poi-heading">Add custom POI</h3>
        <button id="add-poi-close" class="icon-btn small" title="Close"><i class="ico close"></i></button>
      </div>
      <div class="modal-body">
        <label class="field">
          <span>Name</span>
          <input id="add-poi-name" type="text" placeholder="e.g., I'm generic!"/>
        </label>
        <label class="field">
          <span>Description (optional)</span>
          <input id="add-poi-desc" type="text" placeholder="Extra info shown in GPX & device"/>
        </label>

        <div class="field">
          <span>POI type</span>
          <div id="add-poi-types" class="type-list">
            <!-- categories + radio items with icons injected here -->
          </div>
        </div>

        <p class="hint">Click “Place on map”, then click the map where the POI should go.</p>
      </div>
      <div class="modal-foot">
        <button id="add-poi-cancel" class="btn btn-ghost" type="button">Cancel</button>
        <button id="add-poi-place" class="btn" type="button">Place on map</button>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@tmcw/togeojson"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <!-- App -->
  <script type="module" src="./js/main.js"></script>

  <!-- Concise Footer -->
  <footer class="site-footer" role="contentinfo" aria-label="Credits">
    <div class="wrap">
      <p>Built with <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer">Leaflet</a>.</p>
      <p style="text-align:center">All files are processed locally in your browser.</p>
      <p>Wahoo&reg;, ACE, BOLT 3, and ROAM 3 are trademarks of Wahoo Fitness; no affiliation.</p>
    </div>
  </footer>
</body>
</html>
